<!DOCTYPE html>
<html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<head>
	<link rel="stylesheet" href="/../../CSS/mainStyle.css">
</head>
<body>
	<div class="center-block">
		<div class="img-title">
			<center><img src="/../../Images/HorLogo.png" class="img-responsive" alt="Responsive image"></img></center>
		</div>
	</div>
	<div class="dropdown">
		<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Order By
			<span class="caret"></span>
		</button>
		<ul class="dropdown-menu">
			<li><a href="#">Episode</a></li>
			<li><a href="/../../Sort/OrderByRank/">Ranking</a></li>
		</ul>
		</div>
	<div class="center-block">
		<div class="ep-list" id="AllEps"></div>
		
		<script>
			var xhttp;
			xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
    				if (this.readyState == 4 && this.status == 200) {
        				getRatings(this);
   				}
			};
			xhttp.open("GET", "/../../Episodes/episodes.xml", true);
			xhttp.send();
			function getBarType(val){
				var barVal = parseFloat(val);
				
				if (barVal > 79.99 && barVal < 90 )
					return "alert";
				else if (barVal > 69.99 && barVal < 80)
					return "info";
				else if (barVal > 59.99 && barVal < 70)
					return "warning";
				else if (barVal < 60)
					return "danger";
				else
					return "success";
			}
			
			function getRatings(xml) {
				var xmlDoc = xml.responseXML;
				var x = xmlDoc.getElementsByTagName("title");
				var imgSrc = xmlDoc.getElementsByTagName("src");
				var href = xmlDoc.getElementsByTagName("href");
				var igRank = xmlDoc.getElementsByTagName("IGscore");
				var ignRank = xmlDoc.getElementsByTagName("ign");
				var metaRank = xmlDoc.getElementsByTagName("metac");
				var gameplay = xmlDoc.getElementsByTagName("gameplay");
				var aesthetics = xmlDoc.getElementsByTagName("aesthetics");
				var content = xmlDoc.getElementsByTagName("content");
				var seasons = xmlDoc.getElementsByTagName("episode");
				var episodes = xmlDoc.getElementsByTagName("episode");
				
				for (var i = 0; i < x.length; i++) {
					var ep = document.createElement("div");
					var title = document.createElement("h2");
					var subtitle = document.createElement("h3");
					var imgNode = document.createElement("img");
					var aNode = document.createElement("a");
					var gameplayCenter = document.createElement("center");
					var gameplayProgress = document.createElement("div");
					var gameplayTxt = document.createElement("p");
					var gameplayCanvas = document.createElement("div");
					var aestheticsCenter = document.createElement("center");
					var aestheticsProgress = document.createElement("div");
					var aestheticsTxt = document.createElement("p");
					var aestheticsCanvas = document.createElement("div");
					var contentCenter = document.createElement("center");
					var contentProgress = document.createElement("div");
					var contentTxt = document.createElement("p");
					var contentCanvas = document.createElement("div");
					var proRatings = document.createElement("center");
					var igLogo = document.createElement("img");
					var igRankTxt = document.createElement("p");
					var ignLogo = document.createElement("img");
					var ignRankTxt = document.createElement("p");
					var metaLogo = document.createElement("img");
					var metaRankTxt = document.createElement("p");
					
					var igRankNode = igRank[i].childNodes[0];
					var ignRankNode = ignRank[i].childNodes[0];
					var metaRankNode = metaRank[i].childNodes[0];
					
					var rankImgStyle = "display: inline-block; max-width: 14%; padding-right: 1.5%;";
					var rankPStyle = "display: inline-block; font-size: 23px; padding-right: 2%;";
					var gameplayScore = gameplay[i].childNodes[0].textContent;
					var aestheticsScore = aesthetics[i].childNodes[0].textContent;
					var contentScore = content[i].childNodes[0].textContent;
					var epNum = episodes[i].getAttribute('episode');
					var seasonNum = seasons[i].getAttribute('season');
					
					var gpBarType = getBarType(gameplayScore);
					var asBarType = getBarType(aestheticsScore);
					var conBarType = getBarType(contentScore);
					
					ep.setAttribute("class","ep");
					
					imgNode.setAttribute("src",imgSrc[i].childNodes[0].textContent);
					imgNode.setAttribute("class","img-responsive");
					imgNode.setAttribute("alt","Responsive image");
					
					aNode.setAttribute("href",href[i].childNodes[0].textContent);
					
					gameplayCenter.setAttribute("style","padding-top: 15px;");
					
					gameplayTxt.setAttribute("style","margin: 0 0 0;");
					gameplayProgress.setAttribute("class","progress skill-bar");
					gameplayCanvas.setAttribute("class","progress-bar progress-bar-" + gpBarType);	
					gameplayCanvas.setAttribute("style","width: " + gameplayScore + "%;");				
					gameplayCanvas.setAttribute("aria-valuenow",gameplayScore);
					gameplayCanvas.setAttribute("aria-valuemin","0");
					gameplayCanvas.setAttribute("aria-valuemax","100");
					gameplayCanvas.textContent = gameplayScore;
					
					aestheticsCenter.setAttribute("style","padding-top: 0px;");
					
					aestheticsTxt.setAttribute("style","margin: 0 0 0;");
					aestheticsProgress.setAttribute("class","progress skill-bar");
					aestheticsCanvas.setAttribute("class","progress-bar progress-bar-" + asBarType);
					aestheticsCanvas.setAttribute("style","width: " + aestheticsScore + "%;");
					aestheticsCanvas.setAttribute("aria-valuenow",aestheticsScore);
					aestheticsCanvas.setAttribute("aria-valuemin","0");
					aestheticsCanvas.setAttribute("aria-valuemax","100");
					aestheticsCanvas.textContent = aestheticsScore;
					
					contentCenter.setAttribute("style","padding-top: 0px;");
					
					contentTxt.setAttribute("style","margin: 0 0 0;");
					contentProgress.setAttribute("class","progress skill-bar");
					contentCanvas.setAttribute("class","progress-bar progress-bar-" + conBarType);
					contentCanvas.setAttribute("style","width: " + contentScore + "%;");
					contentCanvas.setAttribute("aria-valuenow",contentScore);
					contentCanvas.setAttribute("aria-valuemin","0");
					contentCanvas.setAttribute("aria-valuemax","100");
					contentCanvas.textContent = contentScore;
					
					proRatings.setAttribute("class","inline-ratings");
					proRatings.setAttribute("style","padding-top: 15px;");
					
					igLogo.setAttribute("src","/Images/IGLogo.png");
					igLogo.setAttribute("class","img-responsive");
					igLogo.setAttribute("alt","Responsive image");
					igLogo.setAttribute("style",rankImgStyle);
					
					ignLogo.setAttribute("src","/Images/IgnLogo.png");
					ignLogo.setAttribute("class","img-responsive");
					ignLogo.setAttribute("alt","Responsive image");
					ignLogo.setAttribute("style","display: inline-block; max-width: 16%; padding-right: 1%;");
					
					metaLogo.setAttribute("src","/Images/MetaLogo.png");
					metaLogo.setAttribute("class","img-responsive");
					metaLogo.setAttribute("alt","Responsive image");
					metaLogo.setAttribute("style",rankImgStyle);
										
					igRankTxt.setAttribute("style",rankPStyle);
					ignRankTxt.setAttribute("style",rankPStyle);
					metaRankTxt.setAttribute("style",rankPStyle);
					
					title.appendChild(x[i].childNodes[0]);
					
					subtitle.textContent = "Season: " + seasonNum + " Episode: " + epNum;
					
					aNode.appendChild(imgNode);
					
					gameplayTxt.textContent = "Gameplay";
					aestheticsTxt.textContent = "Aesthetics";
					contentTxt.textContent = "Content";
					
					gameplayProgress.appendChild(gameplayCanvas);
					aestheticsProgress.appendChild(aestheticsCanvas);
					contentProgress.appendChild(contentCanvas);
					
					gameplayCenter.appendChild(gameplayTxt);
					gameplayCenter.appendChild(gameplayProgress);
					aestheticsCenter.appendChild(aestheticsTxt);
					aestheticsCenter.appendChild(aestheticsProgress);
					contentCenter.appendChild(contentTxt);
					contentCenter.appendChild(contentProgress);
					
					proRatings.appendChild(igLogo);
					igRankTxt.textContent = igRankNode.textContent;
					proRatings.appendChild(igRankTxt);
					proRatings.appendChild(ignLogo);
					ignRankTxt.textContent = ignRankNode.textContent;
					proRatings.appendChild(ignRankTxt);
					proRatings.appendChild(metaLogo);
					metaRankTxt.textContent = metaRankNode.textContent;
					proRatings.appendChild(metaRankTxt);
					
					ep.appendChild(title);
					ep.appendChild(subtitle);
					ep.appendChild(aNode);
					ep.appendChild(gameplayCenter);
					ep.appendChild(aestheticsCenter);
					ep.appendChild(contentCenter);
					ep.appendChild(proRatings);
					
					document.getElementById("AllEps").appendChild(ep);
			    	}
			}
		</script>
	</div>
	
	<footer>
	</footer>
</body>	
</html>
